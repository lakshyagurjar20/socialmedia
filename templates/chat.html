{% extends 'main.html' %}
{% block content %}
<div class="max-w-3xl mx-auto mt-6 px-4">
  <h2 class="text-xl font-bold text-gray-800 mb-4">ðŸ’¬ Chat with {{ other_user.username }}</h2>

  <!-- Chat messages container -->
  <div id="chat-box" class="bg-white border rounded-lg shadow p-4 h-[400px] overflow-y-scroll">
    {% for message in messages %}
      <div class="mb-3 flex {% if message.sender == request.user %}justify-end{% else %}justify-start{% endif %}">
        <div class="{% if message.sender == request.user %}
                      bg-blue-500 text-white
                    {% else %}
                      bg-gray-200 text-gray-800
                    {% endif %} 
                    px-4 py-2 rounded-xl max-w-[70%]">
          <div class="text-sm">
            <span class="font-semibold">{{ message.sender.username }}</span>
            <span class="text-xs text-gray-300 ml-2">{{ message.timestamp|date:"M d, H:i" }}</span>
          </div>
          <div class="mt-1">{{ message.content }}</div>
        </div>
      </div>
    {% empty %}
      <p class="text-center text-gray-500">No messages yet. Start the conversation!</p>
    {% endfor %}
  </div>

  <!-- Message input -->
  <form method="POST" class="mt-4 flex gap-2">
    {% csrf_token %}
    <input type="text" name="content" class="flex-1 border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-400" placeholder="Type your message..." required autofocus>
    <button type="submit" class="bg-blue-500 text-white px-4 py-2 rounded-lg hover:bg-blue-600">Send</button>
  </form>
</div>

<!-- Auto scroll script -->
<script>
  const chatBox = document.getElementById("chat-box");
  if (chatBox) {
    chatBox.scrollTop = chatBox.scrollHeight;
  }
</script>
{% endblock %}
